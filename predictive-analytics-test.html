<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predictive Analytics Dashboard - Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Chart animations */
        .forecast-bar {
            animation: growBar 1s ease-out forwards;
            transform-origin: bottom;
        }

        @keyframes growBar {
            from { transform: scaleY(0); }
            to { transform: scaleY(1); }
        }

        .confidence-ring {
            animation: drawRing 1.5s ease-out forwards;
        }

        @keyframes drawRing {
            from { stroke-dashoffset: 314; }
            to { stroke-dashoffset: 0; }
        }

        /* Anomaly pulse */
        .anomaly-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .tooltip.show {
            opacity: 1;
        }

        /* Slider */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            border-radius: 8px;
            height: 8px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
    </style>
</head>
<body class="p-6">
    <!-- Header -->
    <div class="max-w-7xl mx-auto mb-6">
        <h1 class="text-3xl font-bold text-white mb-2">Predictive Analytics Dashboard</h1>
        <p class="text-white/70">Test environment - Following RULES.md standards</p>
    </div>

    <!-- Tooltip (hidden by default) -->
    <div id="tooltip" class="tooltip"></div>

    <div class="max-w-7xl mx-auto space-y-6">
        <!-- Row 1: Forecasting Chart + ML Confidence -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 30-Day Workload Forecast -->
            <div class="lg:col-span-2 glass rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h3 class="font-bold text-white mb-1">30-Day Workload Forecast</h3>
                        <p class="text-sm text-white/70">Predicted case volume based on historical patterns</p>
                    </div>
                    <button
                        id="exportForecastBtn"
                        class="px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg text-blue-300 transition-all text-sm"
                        aria-label="Export forecast data">
                        <i class="fas fa-download mr-2"></i>Export
                    </button>
                </div>

                <!-- Chart -->
                <div class="relative h-64 flex items-end justify-between gap-1" id="forecastChart">
                    <!-- Bars will be generated by JS -->
                </div>

                <!-- Legend -->
                <div class="flex items-center justify-center gap-4 mt-4 text-sm">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-gradient-to-r from-blue-400 to-cyan-500 rounded"></div>
                        <span class="text-white/70">Historical</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-gradient-to-r from-purple-400 to-pink-500 rounded"></div>
                        <span class="text-white/70">Predicted</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-gradient-to-r from-yellow-400 to-orange-500 rounded"></div>
                        <span class="text-white/70">Anomaly</span>
                    </div>
                </div>
            </div>

            <!-- ML Confidence Scores -->
            <div class="glass rounded-xl p-6">
                <h3 class="font-bold text-white mb-4">ML Confidence Scores</h3>

                <div class="space-y-4">
                    <!-- Overall Confidence Ring -->
                    <div class="text-center">
                        <div class="relative w-32 h-32 mx-auto mb-3">
                            <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 120 120">
                                <circle cx="60" cy="60" r="50" fill="none" stroke="rgb(75 85 99)" stroke-width="8"/>
                                <circle
                                    cx="60" cy="60" r="50"
                                    fill="none"
                                    stroke="url(#gradient1)"
                                    stroke-width="8"
                                    stroke-linecap="round"
                                    stroke-dasharray="314"
                                    stroke-dashoffset="62.8"
                                    class="confidence-ring"/>
                                <defs>
                                    <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-white">87%</div>
                                    <div class="text-xs text-white/70">Overall</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Individual Model Scores -->
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-white/70">Workload Model</span>
                                <span class="text-green-400 font-medium">92%</span>
                            </div>
                            <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-green-400 to-emerald-500 rounded-full" style="width: 92%"></div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-white/70">Resource Model</span>
                                <span class="text-blue-400 font-medium">85%</span>
                            </div>
                            <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-blue-400 to-cyan-500 rounded-full" style="width: 85%"></div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-white/70">Anomaly Detection</span>
                                <span class="text-purple-400 font-medium">84%</span>
                            </div>
                            <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-purple-400 to-pink-500 rounded-full" style="width: 84%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <p class="text-xs text-blue-300">
                            <i class="fas fa-info-circle mr-1"></i>
                            Models trained on 6 months of historical data
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Row 2: Resource Recommendations + Anomaly Detection -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- AI Resource Allocation -->
            <div class="glass rounded-xl p-6">
                <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-users-cog text-blue-400"></i>
                    AI Resource Recommendations
                </h3>

                <div class="space-y-4" id="resourceRecommendations">
                    <!-- Generated by JS -->
                </div>

                <div class="mt-4 pt-4 border-t border-white/10">
                    <button
                        id="applyRecommendationsBtn"
                        class="w-full px-4 py-2 bg-gradient-to-r from-green-500 to-blue-600 rounded-lg text-white font-medium hover:shadow-lg transition-all"
                        aria-label="Apply recommendations">
                        <i class="fas fa-check mr-2"></i>Apply Recommendations
                    </button>
                </div>
            </div>

            <!-- Anomaly Detection Alerts -->
            <div class="glass rounded-xl p-6">
                <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                    Anomaly Detection Alerts
                </h3>

                <div class="space-y-3" id="anomalyAlerts">
                    <!-- Generated by JS -->
                </div>

                <div class="mt-4 text-center">
                    <button class="text-sm text-blue-400 hover:text-blue-300 transition-all">
                        View All Alerts <i class="fas fa-arrow-right ml-1"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Row 3: What-If Analysis Scenario Planner -->
        <div class="glass rounded-xl p-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="font-bold text-white mb-1 flex items-center gap-2">
                        <i class="fas fa-sliders-h text-purple-400"></i>
                        What-If Analysis: Scenario Planning
                    </h3>
                    <p class="text-sm text-white/70">Adjust variables to test different scenarios</p>
                </div>
                <button
                    id="resetScenariosBtn"
                    class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white text-sm transition-all"
                    aria-label="Reset to defaults">
                    <i class="fas fa-undo mr-2"></i>Reset
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Scenario Controls -->
                <div class="space-y-6">
                    <div>
                        <label class="text-white/70 text-sm mb-2 block">Staffing Level Adjustment</label>
                        <input
                            type="range"
                            id="staffingSlider"
                            min="50"
                            max="150"
                            value="100"
                            class="w-full"
                            aria-label="Adjust staffing level">
                        <div class="flex justify-between text-xs text-white/50 mt-1">
                            <span>-50%</span>
                            <span id="staffingValue" class="text-white font-medium">100%</span>
                            <span>+50%</span>
                        </div>
                    </div>

                    <div>
                        <label class="text-white/70 text-sm mb-2 block">Expected Case Volume Change</label>
                        <input
                            type="range"
                            id="volumeSlider"
                            min="50"
                            max="150"
                            value="100"
                            class="w-full"
                            aria-label="Adjust case volume">
                        <div class="flex justify-between text-xs text-white/50 mt-1">
                            <span>-50%</span>
                            <span id="volumeValue" class="text-white font-medium">100%</span>
                            <span>+50%</span>
                        </div>
                    </div>

                    <div>
                        <label class="text-white/70 text-sm mb-2 block">Process Efficiency</label>
                        <input
                            type="range"
                            id="efficiencySlider"
                            min="70"
                            max="130"
                            value="100"
                            class="w-full"
                            aria-label="Adjust efficiency">
                        <div class="flex justify-between text-xs text-white/50 mt-1">
                            <span>70%</span>
                            <span id="efficiencyValue" class="text-white font-medium">100%</span>
                            <span>130%</span>
                        </div>
                    </div>

                    <button
                        id="runScenarioBtn"
                        class="w-full px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg text-white font-medium hover:shadow-lg transition-all"
                        aria-label="Run scenario analysis">
                        <i class="fas fa-play mr-2"></i>Run Scenario Analysis
                    </button>
                </div>

                <!-- Scenario Results -->
                <div class="glass-dark rounded-lg p-6">
                    <h4 class="text-white font-bold mb-4">Predicted Outcomes</h4>
                    <div id="scenarioResults" class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-blue-500/10 rounded-lg">
                            <div>
                                <div class="text-white/70 text-sm">Average Processing Time</div>
                                <div class="text-2xl font-bold text-white mt-1">2.4 days</div>
                            </div>
                            <div class="text-green-400">
                                <i class="fas fa-arrow-down"></i> 12%
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-3 bg-purple-500/10 rounded-lg">
                            <div>
                                <div class="text-white/70 text-sm">Capacity Utilization</div>
                                <div class="text-2xl font-bold text-white mt-1">78%</div>
                            </div>
                            <div class="text-yellow-400">
                                <i class="fas fa-minus"></i> 0%
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-3 bg-green-500/10 rounded-lg">
                            <div>
                                <div class="text-white/70 text-sm">Backlog Reduction</div>
                                <div class="text-2xl font-bold text-white mt-1">45%</div>
                            </div>
                            <div class="text-green-400">
                                <i class="fas fa-arrow-up"></i> 15%
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-3 bg-red-500/10 rounded-lg">
                            <div>
                                <div class="text-white/70 text-sm">Resource Cost Impact</div>
                                <div class="text-2xl font-bold text-white mt-1">$0</div>
                            </div>
                            <div class="text-white/50">
                                <i class="fas fa-minus"></i> 0%
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Added 2024-12-09: Predictive Analytics Dashboard
        // MOCK DATA - Replace in production
        // TODO: Connect to AI/ML API endpoints

        // Generate 6 months of historical data + 30 days forecast
        const historicalData = [];
        const forecastData = [];

        // Generate historical data (180 days)
        for (let i = 180; i >= 0; i--) {
            const baseValue = 250;
            const seasonalEffect = Math.sin(i / 30) * 50;
            const randomVariation = (Math.random() - 0.5) * 40;
            const value = Math.max(150, Math.floor(baseValue + seasonalEffect + randomVariation));

            historicalData.push({
                date: new Date(Date.now() - i * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                cases: value
            });
        }

        // Generate forecast data (30 days)
        for (let i = 1; i <= 30; i++) {
            const baseValue = 270;
            const seasonalEffect = Math.sin(i / 30) * 55;
            const trendEffect = i * 2;
            const value = Math.floor(baseValue + seasonalEffect + trendEffect);

            forecastData.push({
                date: new Date(Date.now() + i * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                cases: value,
                confidence: Math.max(70, 90 - i)
            });
        }

        // Render forecast chart
        function renderForecastChart() {
            const chart = document.getElementById('forecastChart');
            const lastDays = historicalData.slice(-15);
            const allData = [...lastDays, ...forecastData.slice(0, 15)];

            const maxValue = Math.max(...allData.map(d => d.cases));

            chart.innerHTML = allData.map((day, index) => {
                const height = (day.cases / maxValue) * 100;
                const isHistorical = index < 15;
                const isAnomaly = day.cases > 320 || day.cases < 200;

                let gradient = isHistorical
                    ? 'from-blue-400 to-cyan-500'
                    : 'from-purple-400 to-pink-500';

                if (isAnomaly) gradient = 'from-yellow-400 to-orange-500';

                return `
                    <div
                        class="forecast-bar flex-1 bg-gradient-to-t ${gradient} rounded-t cursor-pointer hover:opacity-80 transition-all"
                        style="height: ${height}%; animation-delay: ${index * 50}ms"
                        data-cases="${day.cases}"
                        data-date="${day.date}"
                        data-confidence="${day.confidence || 100}"
                        onmouseenter="showTooltip(event, this)"
                        onmouseleave="hideTooltip()">
                    </div>
                `;
            }).join('');
        }

        // Tooltip functions
        function showTooltip(event, element) {
            const tooltip = document.getElementById('tooltip');
            const cases = element.dataset.cases;
            const date = element.dataset.date;
            const confidence = element.dataset.confidence;

            tooltip.innerHTML = `
                <strong>${new Date(date).toLocaleDateString()}</strong><br>
                Cases: ${cases}<br>
                ${confidence < 100 ? `Confidence: ${confidence}%` : 'Historical Data'}
            `;

            tooltip.style.left = event.pageX + 10 + 'px';
            tooltip.style.top = event.pageY - 50 + 'px';
            tooltip.classList.add('show');
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('show');
        }

        // Resource recommendations
        const recommendations = [
            {
                department: 'Permit Processing',
                current: 12,
                recommended: 15,
                impact: '+18% throughput',
                priority: 'high'
            },
            {
                department: 'Compliance Review',
                current: 8,
                recommended: 10,
                impact: '+12% efficiency',
                priority: 'medium'
            },
            {
                department: 'Public Services',
                current: 20,
                recommended: 18,
                impact: '-5% cost',
                priority: 'low'
            }
        ];

        function renderResourceRecommendations() {
            const container = document.getElementById('resourceRecommendations');
            container.innerHTML = recommendations.map(rec => {
                const priorityColors = {
                    high: 'border-red-500/50 bg-red-500/10',
                    medium: 'border-yellow-500/50 bg-yellow-500/10',
                    low: 'border-green-500/50 bg-green-500/10'
                };

                const change = rec.recommended - rec.current;
                const changeText = change > 0 ? `+${change}` : change;
                const changeColor = change > 0 ? 'text-green-400' : 'text-red-400';

                return `
                    <div class="p-4 border rounded-lg ${priorityColors[rec.priority]}">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-white font-medium">${rec.department}</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-white/10 text-white/70">${rec.priority.toUpperCase()}</span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <div>
                                <span class="text-white/70">Current:</span>
                                <span class="text-white ml-2">${rec.current} staff</span>
                            </div>
                            <div>
                                <i class="fas fa-arrow-right text-white/50 mx-2"></i>
                            </div>
                            <div>
                                <span class="text-white/70">Recommended:</span>
                                <span class="text-white ml-2">${rec.recommended} staff</span>
                            </div>
                        </div>
                        <div class="mt-2 text-xs ${changeColor}">
                            <i class="fas fa-chart-line mr-1"></i>${rec.impact}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Anomaly alerts
        const anomalies = [
            {
                type: 'Workload Spike',
                description: 'Permit applications up 45% week-over-week',
                severity: 'critical',
                time: '2 hours ago',
                department: 'Building Permits'
            },
            {
                type: 'Processing Delay',
                description: 'Average processing time increased by 28%',
                severity: 'warning',
                time: '5 hours ago',
                department: 'Tax Services'
            },
            {
                type: 'Resource Underutilization',
                description: 'Staff capacity at 42% in evening shift',
                severity: 'info',
                time: '1 day ago',
                department: 'Public Works'
            }
        ];

        function renderAnomalyAlerts() {
            const container = document.getElementById('anomalyAlerts');
            container.innerHTML = anomalies.map(alert => {
                const severityConfig = {
                    critical: { color: 'red', icon: 'fa-exclamation-circle', pulse: true },
                    warning: { color: 'yellow', icon: 'fa-exclamation-triangle', pulse: false },
                    info: { color: 'blue', icon: 'fa-info-circle', pulse: false }
                };

                const config = severityConfig[alert.severity];

                return `
                    <div class="p-4 border border-${config.color}-500/30 bg-${config.color}-500/10 rounded-lg">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 rounded-full bg-${config.color}-500/20 flex items-center justify-center flex-shrink-0 ${config.pulse ? 'anomaly-pulse' : ''}">
                                <i class="fas ${config.icon} text-${config.color}-400"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-1">
                                    <span class="text-white font-medium text-sm">${alert.type}</span>
                                    <span class="text-xs text-white/50">${alert.time}</span>
                                </div>
                                <p class="text-sm text-white/70 mb-2">${alert.description}</p>
                                <div class="flex items-center gap-2 text-xs text-white/50">
                                    <i class="fas fa-building"></i>
                                    <span>${alert.department}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Scenario planning
        const sliders = {
            staffing: document.getElementById('staffingSlider'),
            volume: document.getElementById('volumeSlider'),
            efficiency: document.getElementById('efficiencySlider')
        };

        const values = {
            staffing: document.getElementById('staffingValue'),
            volume: document.getElementById('volumeValue'),
            efficiency: document.getElementById('efficiencyValue')
        };

        // Update slider values
        Object.keys(sliders).forEach(key => {
            sliders[key].addEventListener('input', (e) => {
                values[key].textContent = e.target.value + '%';
            });
        });

        // Run scenario analysis
        document.getElementById('runScenarioBtn').addEventListener('click', () => {
            const staffingLevel = parseInt(sliders.staffing.value);
            const volumeLevel = parseInt(sliders.volume.value);
            const efficiencyLevel = parseInt(sliders.efficiency.value);

            // Calculate predicted outcomes
            const baseProcessingTime = 2.4;
            const baseUtilization = 78;
            const baseBacklog = 45;
            const baseCost = 0;

            const processingTime = (baseProcessingTime * (100 / efficiencyLevel) * (volumeLevel / 100) * (100 / staffingLevel)).toFixed(1);
            const utilization = Math.min(100, Math.floor(baseUtilization * (volumeLevel / 100) * (100 / staffingLevel)));
            const backlog = Math.max(0, Math.floor(baseBacklog * (volumeLevel / 100) * (100 / staffingLevel) * (100 / efficiencyLevel)));
            const cost = Math.floor((staffingLevel - 100) * 1000);

            const processingChange = Math.floor(((processingTime - baseProcessingTime) / baseProcessingTime) * 100);
            const utilizationChange = utilization - baseUtilization;
            const backlogChange = backlog - baseBacklog;

            document.getElementById('scenarioResults').innerHTML = `
                <div class="flex items-center justify-between p-3 bg-blue-500/10 rounded-lg">
                    <div>
                        <div class="text-white/70 text-sm">Average Processing Time</div>
                        <div class="text-2xl font-bold text-white mt-1">${processingTime} days</div>
                    </div>
                    <div class="${processingChange < 0 ? 'text-green-400' : 'text-red-400'}">
                        <i class="fas fa-arrow-${processingChange < 0 ? 'down' : 'up'}"></i> ${Math.abs(processingChange)}%
                    </div>
                </div>

                <div class="flex items-center justify-between p-3 bg-purple-500/10 rounded-lg">
                    <div>
                        <div class="text-white/70 text-sm">Capacity Utilization</div>
                        <div class="text-2xl font-bold text-white mt-1">${utilization}%</div>
                    </div>
                    <div class="${utilizationChange === 0 ? 'text-white/50' : utilizationChange > 0 ? 'text-yellow-400' : 'text-green-400'}">
                        <i class="fas fa-${utilizationChange === 0 ? 'minus' : utilizationChange > 0 ? 'arrow-up' : 'arrow-down'}"></i> ${Math.abs(utilizationChange)}%
                    </div>
                </div>

                <div class="flex items-center justify-between p-3 bg-green-500/10 rounded-lg">
                    <div>
                        <div class="text-white/70 text-sm">Backlog Reduction</div>
                        <div class="text-2xl font-bold text-white mt-1">${backlog}%</div>
                    </div>
                    <div class="${backlogChange > 0 ? 'text-red-400' : 'text-green-400'}">
                        <i class="fas fa-arrow-${backlogChange > 0 ? 'up' : 'down'}"></i> ${Math.abs(backlogChange)}%
                    </div>
                </div>

                <div class="flex items-center justify-between p-3 bg-red-500/10 rounded-lg">
                    <div>
                        <div class="text-white/70 text-sm">Resource Cost Impact</div>
                        <div class="text-2xl font-bold text-white mt-1">${cost >= 0 ? '+' : ''}$${Math.abs(cost).toLocaleString()}</div>
                    </div>
                    <div class="${cost === 0 ? 'text-white/50' : cost > 0 ? 'text-red-400' : 'text-green-400'}">
                        <i class="fas fa-${cost === 0 ? 'minus' : cost > 0 ? 'arrow-up' : 'arrow-down'}"></i> ${staffingLevel - 100}%
                    </div>
                </div>
            `;
        });

        // Reset scenarios
        document.getElementById('resetScenariosBtn').addEventListener('click', () => {
            sliders.staffing.value = 100;
            sliders.volume.value = 100;
            sliders.efficiency.value = 100;

            values.staffing.textContent = '100%';
            values.volume.textContent = '100%';
            values.efficiency.textContent = '100%';

            document.getElementById('runScenarioBtn').click();
        });

        // Export functionality
        document.getElementById('exportForecastBtn').addEventListener('click', () => {
            const data = {
                historical: historicalData,
                forecast: forecastData,
                exportedAt: new Date().toISOString(),
                mlConfidence: 87
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `forecast-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            alert('Forecast data exported successfully!');
        });

        document.getElementById('applyRecommendationsBtn').addEventListener('click', () => {
            alert('Resource recommendations applied! Staff assignments will be updated in the next scheduling cycle.');
        });

        // Initialize on load
        renderForecastChart();
        renderResourceRecommendations();
        renderAnomalyAlerts();
        document.getElementById('runScenarioBtn').click(); // Initialize scenario results
    </script>
</body>
</html>
